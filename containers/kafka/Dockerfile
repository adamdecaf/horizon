FROM java:openjdk-8-jre

ENV KAFKA_VERSION 0.9.0.1
ENV SCALA_VERSION 2.11

RUN wget -O /opt/kafka.tgz http://apache.claz.org/kafka/$KAFKA_VERSION/kafka_$SCALA_VERSION-$KAFKA_VERSION.tgz && \
    tar xf /opt/kafka.tgz -C /opt && \
    rm /opt/kafka.tgz

ADD kafka-graphite-1.1.2.jar /opt/kafka_$SCALA_VERSION-$KAFKA_VERSION/libs/
ADD metrics-graphite-2.2.0.jar /opt/kafka_$SCALA_VERSION-$KAFKA_VERSION/libs/

ADD start-kafka.sh /start-kafka.sh

ENV KAFKA_HOME /opt/kafka_$SCALA_VERSION-$KAFKA_VERSION

#ENV KAFKA_ADVERTISED_HOST_NAME localhost
ENV KAFKA_HOST_NAME 0.0.0.0
#ENV KAFKA_ZOOKEEPER_CONNECT zookeeper:2181/kafka
ENV KAFKA_ZOOKEEPER_CHROOT_PATH /kafka
ENV KAFKA_BROKER_ID 1
ENV KAFKA_AUTO_CREATE_TOPICS_ENABLE true
ENV KAFKA_DELETE_TOPIC_ENABLE true
ENV KAFKA_NUM_PARTITIONS 3
ENV KAFKA_DEFAULT_REPLICATION_FACTOR 1
ENV KAFKA_OFFSETS_TOPIC_NUM_PARTITIONS 50
ENV KAFKA_AUTO_LEADER_REBALANCE_ENABLE true
ENV KAFKA_CONTROLLED_SHUTDOWN_ENABLE true
ENV KAFKA_LOG_CLEANER_ENABLE true
ENV KAFKA_LOG_RETENTION_HOURS 168

ENV KAFKA_PORT 9092
EXPOSE 9092

ENV KAFKA_LOG_DIRS /kafka
VOLUME /kafka

ENV DELAY_KAFKA_STARTUP 0

CMD /start-kafka.sh
